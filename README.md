# Solana Token Account Closer

Автоматическое закрытие пустых Token Accounts в Solana и возврат SOL (rent).

## Что это?

Каждый Token Account в Solana хранит **~0.00203928 SOL** в виде rent (арендной платы). Когда токен-аккаунт пустой (баланс = 0), его можно закрыть и вернуть SOL обратно. Этот инструмент автоматизирует процесс для множества кошельков.

## Режимы

| # | Режим | Описание |
|---|-------|----------|
| 1 | **CHECK** | Сканирует кошельки и показывает сколько SOL можно вернуть |
| 2 | **FUND** | Раздает SOL с основного кошелька на eligible кошельки (для комиссий) |
| 3 | **CLAIM** | Закрывает пустые токен-аккаунты и возвращает SOL |
| 4 | **COLLECT** | Собирает всю SOL обратно на основной кошелёк |

## Быстрый старт

### 1. Установка

```bash
npm install
```

### 2. Настройка

Отредактируйте `config.js`:

```javascript
export const CONFIG = {
  // RPC endpoint (рекомендуется Helius, QuickNode или Alchemy)
  RPC_ENDPOINT: 'https://api.mainnet-beta.solana.com',

  // Файл с приватными ключами (один на строку)
  WALLETS_FILE: 'wallets.txt',

  // Файл с приватным ключом основного кошелька (для FUND и COLLECT)
  FUND_FILE: 'fund.txt',

  // Производительность
  PARALLEL_WALLETS: 3,
  BATCH_SIZE: 3,
  DELAY_BETWEEN_WALLETS: 1000,
  DELAY_BETWEEN_BATCHES: 2000,
};
```

### 3. Подготовка файлов

**wallets.txt** - приватные ключи в формате Base58 (один на строку):
```
4C88TX9MKrKxW6yW7vW3u8At1fMa7puzknNeFjsEyL6p...
3Q3HiKduGENPssDD8GM8Qc9UuJMEZvUJsfXSV2srZMTA...
```

**fund.txt** - приватный ключ основного кошелька (одна строка, Base58):
```
5Kd3NBUAdUnhyzenEwVLy9pBKxSwXvE9FMPyR4UKZvpe...
```

### 4. Запуск

```bash
npm start
```

## Рекомендуемый порядок

```
1. CHECK   - Найти кошельки с пустыми токен-аккаунтами
2. FUND    - Отправить ~0.001 SOL на каждый eligible кошелёк для комиссий
3. CLAIM   - Закрыть пустые аккаунты и вернуть SOL
4. COLLECT - Собрать всю SOL обратно на основной кошелёк
```

### Пошагово

```bash
# 1. Сканируем все кошельки
npm start  # выбрать 1 (CHECK)
# Создаются: eligible_wallets_keys.txt, eligible_wallets_address.txt

# 2. Копируем eligible ключи в wallets.txt для CLAIM
cp eligible_wallets_keys.txt wallets.txt

# 3. Пополняем eligible кошельки SOL для комиссий
npm start  # выбрать 2 (FUND)
# Ввести сумму на каждый кошелёк (например 0.001)

# 4. Клеймим SOL с пустых токен-аккаунтов
npm start  # выбрать 3 (CLAIM)
# Создаётся: successful_wallets.txt

# 5. Собираем всю SOL на основной кошелёк
npm start  # выбрать 4 (COLLECT)
# Отправляет всё на кошелёк из fund.txt
```

## Выходные файлы

| Файл | Создаётся в | Содержит |
|------|-------------|----------|
| `eligible_wallets_keys.txt` | CHECK | Приватные ключи кошельков с доступным SOL |
| `eligible_wallets_address.txt` | CHECK | Адреса кошельков с доступным SOL |
| `successful_wallets.txt` | CLAIM | Приватные ключи кошельков где SOL был возвращён |

## Настройки производительности

В `config.js`:

| Параметр | Описание | По умолчанию |
|----------|----------|--------------|
| `PARALLEL_WALLETS` | Кошельков обрабатываемых одновременно | 3 |
| `BATCH_SIZE` | Токен-аккаунтов закрываемых за одну транзакцию | 3 |
| `DELAY_BETWEEN_WALLETS` | Задержка между кошельками (мс) | 1000 |
| `DELAY_BETWEEN_BATCHES` | Задержка между батчами (мс) | 2000 |

**Рекомендации:**
- Бесплатный RPC: `PARALLEL_WALLETS: 1`, увеличить задержки
- Платный RPC (Helius/QuickNode): `PARALLEL_WALLETS: 3-5`, меньшие задержки
- Ошибки 429: увеличить задержки или уменьшить параллельность

## Безопасность

- Приватные ключи хранятся только локально
- Все файлы с ключами добавлены в `.gitignore`
- Никакие данные не отправляются никуда кроме Solana RPC
- **НЕ ДЕЛИТЕСЬ** файлами `wallets.txt`, `fund.txt` и выходными файлами

## FAQ

**Сколько SOL можно вернуть?**
~0.00203928 SOL за каждый пустой Token Account

**Нужен ли SOL на каждом кошельке для клейма?**
Да, минимум 0.001 SOL для оплаты комиссий. Используйте режим FUND для раздачи.

**Что делать при ошибке "expired transaction"?**
Это нормально. Скрипт автоматически повторит попытку для каждого аккаунта отдельно.

**Можно ли использовать бесплатный RPC?**
Да, но установите `PARALLEL_WALLETS: 1` и увеличьте задержки.

## Устранение ошибок

| Ошибка | Решение |
|--------|---------|
| Insufficient SOL for fees | Пополните кошелёк минимум на 0.001 SOL |
| 429 Too Many Requests | Увеличьте задержки в `config.js` или используйте платный RPC |
| Transaction failed | Проверьте баланс SOL, увеличьте задержки, уменьшите `BATCH_SIZE` |
| Expired transaction | Нормальное поведение, скрипт повторит автоматически |

## Лицензия

MIT

## Дисклеймер

Используйте на свой страх и риск. Всегда тестируйте на небольших суммах.
